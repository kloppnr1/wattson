# Multi-stage build: build static files, serve via Nginx
# Nginx also reverse-proxies /api to the API container

FROM node:22-alpine AS build
WORKDIR /app
COPY src/WattsOn.Frontend/package*.json ./
RUN npm ci
COPY src/WattsOn.Frontend/ .
RUN npm run build

FROM nginx:alpine AS final
# Copy built static files
COPY --from=build /app/dist /usr/share/nginx/html
# Copy Nginx config
COPY src/WattsOn.Frontend/nginx.staging.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
